#!/bin/bash

echo "üöÄ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ Netty vs Legacy –ø–∞—Ä—Å–µ—Ä–∞"
echo "=================================================="

# –°–æ–∑–¥–∞–µ–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –¥–ª—è —Ç–µ—Å—Ç–æ–≤ –µ—Å–ª–∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
mkdir -p downloads

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∏–∑–º–µ—Ä–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
measure_time() {
    local start_time=$(date +%s.%N)
    "$@"
    local end_time=$(date +%s.%N)
    local duration=$(echo "$end_time - $start_time" | bc -l)
    echo "$duration"
}

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ–¥ —Ç–µ—Å—Ç–æ–º
clean_db() {
    echo "üßπ –û—á–∏—Å—Ç–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö..."
    rm -f parser_data.db
}

# –¢–µ—Å—Ç 1: Legacy –ø–∞—Ä—Å–µ—Ä (100 —Å—Å—ã–ª–æ–∫)
echo ""
echo "üìä –¢–ï–°–¢ 1: Legacy –ø–∞—Ä—Å–µ—Ä (100 —Å—Å—ã–ª–æ–∫)"
echo "----------------------------------------"
clean_db
echo "‚è±Ô∏è –ó–∞–ø—É—Å–∫ legacy –ø–∞—Ä—Å–µ—Ä–∞..."
legacy_time=$(measure_time java -jar target/image-parser-1.0.0.jar fixed postimages 100)
echo "‚úÖ Legacy –ø–∞—Ä—Å–µ—Ä –∑–∞–≤–µ—Ä—à–µ–Ω –∑–∞ ${legacy_time} —Å–µ–∫—É–Ω–¥"

# –¢–µ—Å—Ç 2: Netty –ø–∞—Ä—Å–µ—Ä (100 —Å—Å—ã–ª–æ–∫)
echo ""
echo "üìä –¢–ï–°–¢ 2: Netty –ø–∞—Ä—Å–µ—Ä (100 —Å—Å—ã–ª–æ–∫)"
echo "----------------------------------------"
clean_db
echo "‚è±Ô∏è –ó–∞–ø—É—Å–∫ Netty –ø–∞—Ä—Å–µ—Ä–∞..."
netty_time=$(measure_time java -jar target/image-parser-1.0.0.jar --netty netty-fixed postimages 100)
echo "‚úÖ Netty –ø–∞—Ä—Å–µ—Ä –∑–∞–≤–µ—Ä—à–µ–Ω –∑–∞ ${netty_time} —Å–µ–∫—É–Ω–¥"

# –í—ã—á–∏—Å–ª—è–µ–º —É—Å–∫–æ—Ä–µ–Ω–∏–µ
speedup=$(echo "scale=2; $legacy_time / $netty_time" | bc -l)
echo ""
echo "üìà –†–ï–ó–£–õ–¨–¢–ê–¢–´ –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–ò:"
echo "=================================="
echo "Legacy –ø–∞—Ä—Å–µ—Ä: ${legacy_time} —Å–µ–∫—É–Ω–¥"
echo "Netty –ø–∞—Ä—Å–µ—Ä:  ${netty_time} —Å–µ–∫—É–Ω–¥"
echo "–£—Å–∫–æ—Ä–µ–Ω–∏–µ:     ${speedup}x"

# –¢–µ—Å—Ç 3: –ë–æ–ª—å—à–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ (1000 —Å—Å—ã–ª–æ–∫)
echo ""
echo "üìä –¢–ï–°–¢ 3: –ë–æ–ª—å—à–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ (1000 —Å—Å—ã–ª–æ–∫)"
echo "--------------------------------------------"
clean_db
echo "‚è±Ô∏è –ó–∞–ø—É—Å–∫ Netty –ø–∞—Ä—Å–µ—Ä–∞ –Ω–∞ 1000 —Å—Å—ã–ª–æ–∫..."
netty_1000_time=$(measure_time java -jar target/image-parser-1.0.0.jar --netty netty-fixed postimages 1000)
echo "‚úÖ Netty –ø–∞—Ä—Å–µ—Ä (1000 —Å—Å—ã–ª–æ–∫) –∑–∞–≤–µ—Ä—à–µ–Ω –∑–∞ ${netty_1000_time} —Å–µ–∫—É–Ω–¥"

# –í—ã—á–∏—Å–ª—è–µ–º RPS
legacy_rps=$(echo "scale=2; 100 / $legacy_time" | bc -l)
netty_rps=$(echo "scale=2; 100 / $netty_time" | bc -l)
netty_1000_rps=$(echo "scale=2; 1000 / $netty_1000_time" | bc -l)

echo ""
echo "üìä –î–ï–¢–ê–õ–¨–ù–ê–Ø –°–¢–ê–¢–ò–°–¢–ò–ö–ê:"
echo "========================"
echo "Legacy –ø–∞—Ä—Å–µ—Ä (100 —Å—Å—ã–ª–æ–∫): ${legacy_rps} RPS"
echo "Netty –ø–∞—Ä—Å–µ—Ä (100 —Å—Å—ã–ª–æ–∫):  ${netty_rps} RPS"
echo "Netty –ø–∞—Ä—Å–µ—Ä (1000 —Å—Å—ã–ª–æ–∫): ${netty_1000_rps} RPS"
echo ""
echo "üöÄ Netty –ø–∞—Ä—Å–µ—Ä –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —É—Å–∫–æ—Ä–µ–Ω–∏–µ –≤ ${speedup} —Ä–∞–∑!"
echo ""
echo "üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:"
echo "‚Ä¢ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ --netty –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏"
echo "‚Ä¢ Netty –ø–∞—Ä—Å–µ—Ä –º–æ–∂–µ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å 1000+ —Å—Å—ã–ª–æ–∫ –≤ –º–∏–Ω—É—Ç—É"
echo "‚Ä¢ –°—Ç—Ä–∏–º–∏–Ω–≥–æ–≤—ã–π –ø–∞—Ä—Å–∏–Ω–≥ —ç–∫–æ–Ω–æ–º–∏—Ç —Ç—Ä–∞—Ñ–∏–∫ –∏ –≤—Ä–µ–º—è"
